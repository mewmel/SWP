<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Trang chủ Bác sĩ - Hệ thống quản lý</title>
    <link rel="stylesheet" href="css/doctor-common.css">
    <link rel="stylesheet" href="css/bac-si-dashboard.css">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
</head>

<body>
    <!-- Header Navigation -->
    <header class="doctor-header">
        <div class="doctor-header-container">
            <nav class="doctor-nav">
                <a href="bac-si-dashboard.html" class="nav-link active">Trang cá nhân</a>
                <a href="blog.html" class="nav-link">Đăng Blog</a>
                <a href="bac-si-lich-lam-viec.html" class="nav-link">Xem lịch làm</a>
                <a href="bac-si-profile.html" class="nav-link">Hồ sơ cá nhân</a>
            </nav>

            <div class="doctor-header-right">
                <div class="notification-wrapper" style="position: relative;">
                    <button class="doctor-notification-btn">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                            stroke-width="2">
                            <path d="M6 8a6 6 0 0 1 12 0c0 7 3 9 3 9H3s3-2 3-9"></path>
                            <path d="M13.73 21a2 2 0 0 1-3.46 0"></path>
                        </svg>
                        <span class="doctor-notification-badge">3</span>
                    </button>
                </div>

                <div class="doctor-profile-info">
                    <div class="doctor-info">
                        <div class="doctor-name" id="doctorName"></div>
                        <div class="doctor-role">Bác sĩ</div>
                    </div>
                    <div class="doctor-avatar">
                        <i class="fas fa-user"></i>
                    </div>
                </div>

                <button class="logout-btn" onclick="logout()">
                    <i class="fas fa-sign-out-alt"></i>
                </button>

                <button class="doctor-mobile-menu">
                    <i class="fas fa-bars"></i>
                </button>
            </div>
        </div>
    </header>
    <div class="doctor-page-container">
        <div class="container">
            <!-- Main Content -->
            <main class="main-content">
                <div class="schedule-section">
                    <div class="schedule-header">
                        <h2>Lịch trình hôm nay</h2>
                        <span class="current-date"></span>
                    </div>
                    <div class="schedule-list">
                        <div class="appointment-item" data-patient="" data-status="">
                            <div class="time" type="time"></div>
                            <div class="appointment-info">
                                <h3>BN: <span class="patient-name"></span></h3>
                                <p class="service-name"></p>
                                <span class="status-badge"></span>
                            </div>
                            <div class="appointment-actions">
                                <i class="fas fa-file-medical"></i> Đã đến khám
                                <i class="fas fa-file-medical"></i> Không đến khám
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </main>
            <!-- Sidebar -->
            <aside class="sidebar">
                <div class="sidebar-section">
                    <h3 class="sidebar-title">
                        <i class="fas fa-users"></i>
                        Quản lý bệnh nhân
                    </h3>
                    <div class="sidebar-menu">
                        <button class="sidebar-item" onclick="window.location.href='xem-danh-sach-benh-nhan.html'">
                            <i class="fas fa-list"></i>
                            <span>Xem danh sách bệnh nhân</span>
                        </button>
                        <button class="sidebar-item" onclick="openScheduleManager()">
                            <i class="fas fa-calendar"></i>
                            <span>Quản lý lịch hẹn</span>
                        </button>
                    </div>
                </div>
            </aside>
        </div>

        <!-- Modal for Patient Record -->
        <div id="patientModal" class="modal">
            <div class="modal-content large-modal">
                <div class="modal-header">
                    <h3><i class="fas fa-file-medical"></i> Hồ sơ bệnh án</h3>
                    <span class="close" onclick="window.closeModal()">&times;</span>
                </div>
                <div class="modal-body">
                    <!-- Patient Basic Info -->
                    <div class="patient-info-section">
                        <div class="patient-header">
                            <div class="patient-avatar">
                                <i class="fas fa-user"></i>
                            </div>
                            <div class="patient-details">
                                <h4 id="patientName"></h4>
                                <p class="patient-id">Mã BN: <span id="cusId"></span></p>
                            </div>
                            <div class="patient-status">
                                <span class="status-badge" id="currentStatus"></span>
                            </div>
                        </div>

                        <div class="info-grid">
                            <div class="info-row">
                                <div class="info-item">
                                    <label><i class="fas fa-venus-mars"></i> Giới tính:</label>
                                    <span id="patientGender"></span>
                                </div>
                                <div class="info-item">
                                    <label><i class="fas fa-birthday-cake"></i> Ngày sinh:</label>
                                    <span id="patientBirthDate"></span>
                                </div>
                            </div>
                            <div class="info-row">
                                <div class="info-item">
                                    <label><i class="fas fa-phone"></i> Số điện thoại:</label>
                                    <span id="patientPhone"></span>
                                </div>
                                <div class="info-item">
                                    <label><i class="fas fa-envelope"></i> Email:</label>
                                    <span id="patientEmail"></span>
                                </div>
                            </div>
                            <div class="info-row">
                                <div class="info-item">
                                    <label><i class="fas fa-map-marker-alt"></i> Địa chỉ:</label>
                                    <span id="patientAddress"></span>
                                </div>
                                <div class="info-item">
                                    <label><i class="fas fa-briefcase"></i> Nghề nghiệp:</label>
                                    <span id="patientOccupation"></span>
                                </div>
                            </div>
                            <div class="info-row">
                                <div class="info-item">
                                    <label><i class="fas fa-phone-alt"></i> Liên hệ khẩn cấp:</label>
                                    <span id="emergencyContact"></span>
                                </div>
                                <div class="info-item">
                                    <label><i class="fas fa-user-check"></i> Trạng thái:</label>
                                    <span id="patientStatus" class="status-active">Hoạt động</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Medical Record Tabs -->
                    <div class="record-tabs">
                        <button class="tab-btn active" onclick="window.switchTab('current')">Khám hôm nay</button>
                        <button class="tab-btn" onclick="window.switchTab('history')">Lịch sử khám</button>
                        <button class="tab-btn" onclick="window.switchTab('treatment')">Điều trị</button>
                        <button class="tab-btn" onclick="window.switchTab('payment')">Thanh toán</button>
                        <button class="tab-btn" onclick="window.switchTab('prescription')">Kê thuốc</button>
                        <button class="tab-btn" onclick="window.switchTab('tests')">Xét nghiệm</button>
                    </div>

                    <!-- Current Examination Tab -->
                    <div id="currentTab" class="tab-content active">
                        <div class="medical-record">
                            <h4><i class="fas fa-stethoscope"></i> Khám bệnh hôm nay</h4>

                            <!-- Booking Information -->
                            <div class="booking-info">
                                <h5><i class="fas fa-calendar-check"></i> Thông tin lịch hẹn</h5>
                                <div class="record-grid">
                                    <div class="record-section">
                                        <label>Loại đặt lịch:</label>
                                        <select id="bookType">
                                            <option value="initial">Khám lần đầu</option>
                                            <option value="follow-up">Tái khám</option>
                                        </select>
                                    </div>
                                    <div class="record-section">
                                        <label>Trạng thái lịch hẹn:</label>
                                        <select id="bookStatus">
                                            <option value="completed">Đã đến khám</option>
                                            <option value="pending">Chưa đến khám</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="record-section">
                                    <label>Ghi chú lịch hẹn:</label>
                                    <textarea id="bookingNote" rows="2" placeholder="Ghi chú về lịch hẹn..."></textarea>
                                </div>
                            </div>

                            <!-- Medical Record Information -->
                            <div class="medical-record-info">
                                <h5><i class="fas fa-file-medical-alt"></i> Hồ sơ bệnh án</h5>
                                <div class="record-grid">
                                    <div class="record-section">
                                        <label>Trạng thái hồ sơ:</label>
                                        <select id="recordStatus">
                                            <option value="active" selected>Đang điều trị</option>
                                            <option value="pending">Chờ xử lý</option>
                                            <option value="closed">Đã kết thúc</option>
                                        </select>
                                    </div>
                                    <div class="record-section">
                                        <label>Ngày tạo hồ sơ:</label>
                                        <input type="datetime-local" id="recordCreatedDate">
                                    </div>
                                </div>

                                <div class="record-section">
                                    <label>Dịch vụ:</label>
                                    <span id="serviceName" rows="3"></span>
                                </div>
                                <div class="record-section">
                                    <label>Chẩn đoán:</label>
                                    <textarea id="diagnosis" rows="4" placeholder="Nhập chẩn đoán..."></textarea>
                                </div>

                                <div class="record-section">
                                    <label>Kế hoạch điều trị:</label>
                                    <textarea id="treatmentPlan" rows="5"
                                        placeholder="Mô tả kế hoạch điều trị..."></textarea>
                                </div>

                                <div class="record-section">
                                    <label>Ngày dự kiến kết thúc điều trị:</label>
                                    <input type="date" id="dischargeDate">
                                </div>

                                <div class="record-section">
                                    <label>Ghi chú hồ sơ:</label>
                                    <textarea id="medicalNote" rows="3"
                                        placeholder="Ghi chú chung về hồ sơ..."></textarea>
                                </div>
                            </div>
                            <!-- Booking Steps -->
                            <div class="booking-steps">
                                <h5><i class="fas fa-list-ol"></i> Quản lý các bước điều trị</h5>
                                <!-- Service Selection -->
                                <div class="service-selection">
                                    <div class="service-dropdown-container">
                                        <label for="serviceSelect"><i class="fas fa-medical-bag"></i> Chọn dịch vụ/bước
                                            cần thực hiện:</label>
                                        <select id="serviceSelect" class="service-dropdown">
                                            <option value="">-- Chọn dịch vụ --</option>
                                        </select>
                                    </div>
                                </div>

                                <!-- Step Form (Hidden by default) -->
                                <div class="step-form" id="stepForm" style="display: none;">
                                    <div class="form-header">
                                        <h6 id="selectedServiceTitle"><i class="fas fa-edit"></i> Thực hiện: </h6>
                                        <span class="form-badge">Đang thực hiện</span>
                                    </div>
                                    <div class="step-form-content">
                                        <div class="record-grid">
                                            <div class="record-section">
                                                <label>Ngày & giờ thực hiện:</label>
                                                <input type="datetime-local" id="performedAt" class="form-control">
                                            </div>
                                            <div class="record-section">
                                                <label>Trạng thái:</label>
                                                <select id="stepStatus" class="form-control">
                                                    <option value="pending">Đang thực hiện</option>
                                                    <option value="completed">Đã hoàn thành</option>
                                                    <option value="inactive">Không hoạt động</option>
                                                </select>
                                            </div>
                                        </div>
                                        <div class="record-section">
                                            <label>Kết quả thực hiện:</label>
                                            <textarea rows="3" placeholder="Mô tả kết quả, chỉ số, tình trạng..."
                                                id="stepResult" class="form-control"></textarea>
                                        </div>
                                        <div class="record-section">
                                            <label>Ghi chú của bác sĩ:</label>
                                            <textarea rows="2" placeholder="Lưu ý, khuyến nghị, hướng dẫn..."
                                                id="stepNote" class="form-control"></textarea>
                                        </div>
                                        <div class="form-actions">
                                            <button type="button" class="btn-save-step" onclick="saveBookingStep()">
                                                <i class="fas fa-save"></i> Lưu bước này
                                            </button>
                                            <button type="button" class="btn-cancel-step" onclick="cancelStepForm()">
                                                <i class="fas fa-times"></i> Hủy
                                            </button>
                                        </div>
                                    </div>
                                </div>
                                <!-- Test Result Form (Hidden by default) -->
                                <div class="test-result-form" id="testResultForm" style="display: none;">
                                <div class="form-header">
                                    <h6 id="selectedTestServiceTitle">
                                        <i class="fas fa-vial"></i> Nhập kết quả xét nghiệm
                                    </h6>
                                    <span class="form-badge">Xét nghiệm</span>
                                </div>
                                <div class="test-form-content">
                                    <div class="record-section" style="display: flex; gap: 1rem; align-items: center;">                                     
                                        <label for="testStatus" style="margin-bottom:0;">Trạng thái:</label>
                                        <select id="testStatus" class="form-control" style="width: 150px;">
                                            <option value="pending">Đang chờ</option>
                                            <option value="completed">Hoàn thành</option>
                                            <option value="cancelled">Đã huỷ</option>
                                        </select>
                                    </div>
                                    <div class="record-section">
                                        <label>Ngày thực hiện:</label>
                                        <input type="datetime-local" id="testPerformedAt" class="form-control">
                                    </div>
                                    <div class="record-section">
                                        <label>Kết quả các chỉ số:</label>
                                        <div id="testResultGrid"></div>
                                        <button type="button" class="btn-add-test-index" onclick="window.addTestResultRow()">
                                            <i class="fas fa-plus"></i> Thêm chỉ số
                                        </button>
                                    </div>
                                    <div class="record-section">
                                        <label>Ghi chú:</label>
                                        <textarea id="testNote" rows="2" class="form-control"></textarea>
                                    </div>
                                    <div class="form-actions">
                                        <button type="button" class="btn-save-step" onclick="window.saveTestResultStep()">
                                            <i class="fas fa-save"></i> Lưu kết quả xét nghiệm
                                        </button>
                                        <button type="button" class="btn-cancel-step" onclick="window.cancelTestResultForm()">
                                            <i class="fas fa-times"></i> Hủy
                                        </button>
                                    </div>
                                </div>
                            </div>

                               
                                <!-- Completed Steps List -->
                                <div class="completed-steps">
                                    <h6><i class="fas fa-check-circle"></i> Các bước đã thực hiện</h6>
                                    <div class="steps-list" id="completedStepsList">
                                        <!-- NODE TEMPLATE ẨN -->
                                        <div class="step-item step-template" style="display:none" data-step-id=""
                                            data-sub-id="" data-sub-name="">
                                            <div class="step-header">
                                                <div class="step-info">
                                                    <strong></strong>
                                                    <span class="step-time"></span>
                                                </div>
                                                <div class="step-actions">
                                                    <span class="step-status"></span>
                                                    <button class="btn-edit-step"><i class="fas fa-edit"></i></button>
                                                </div>
                                            </div>
                                            <div class="step-summary">
                                                <p><strong>Kết quả:</strong> <span class="step-result"></span></p>
                                                <p><strong>Ghi chú:</strong> <span class="step-note"></span></p>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="empty-steps" id="emptySteps" style="display: none;">
                                        <i class="fas fa-clipboard-list"></i>
                                        <p>Chưa có bước nào được thực hiện</p>
                                    </div>
                                </div>
                                <button type="button" class="btn-primary" onclick="window.savePatientRecord()">
                                    <i class="fas fa-save"></i> Lưu kết quả
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Medical History Tab -->
                    <div id="historyTab" class="tab-content">
                        <div class="history-list">
                            <h4><i class="fas fa-history"></i> Lịch sử khám</h4>
                            
                            <!-- Medical History Content -->
                            <div id="medical-history-content">
                                <!-- Dữ liệu sẽ được load động từ API -->
                            </div>
                            
                            <!-- Empty State -->
                            <div id="empty-history" style="display: none;">
                                <div class="empty-state">
                                    <i class="fas fa-history"></i>
                                    <p>Chưa có lịch sử khám</p>
                                    <small>Bệnh nhân này chưa có lịch sử khám trước đó</small>
                                </div>
                            </div>
                            
                            <!-- Loading State -->
                            <div id="loading-history" style="display: none;">
                                <div class="loading-state">
                                    <i class="fas fa-spinner fa-spin"></i>
                                    <p>Đang tải lịch sử khám...</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Treatment Tab -->
                    <div id="treatmentTab" class="tab-content">
                        <div class="treatment-plan">
                            <h4><i class="fas fa-tasks"></i> Kế hoạch điều trị</h4>
                            <div id="treatmentContent">
                                <!-- Treatment plan will be loaded dynamically -->
                            </div>
                        </div>
                    </div>

                    <!-- Payment Tab -->
                    <div id="paymentTab" class="tab-content">
                        <div class="payment-management">
                            <h4><i class="fas fa-credit-card"></i> Quản lý thanh toán</h4>

                            <!-- Loading State -->
                            <div id="loading-payment" style="display: none;">
                                <div class="loading-state">
                                    <i class="fas fa-spinner fa-spin"></i>
                                    <p>Đang tải thông tin thanh toán...</p>
                                </div>
                            </div>

                            <!-- Empty State -->
                            <div id="empty-payment" style="display: none;">
                                <div class="empty-state">
                                    <i class="fas fa-credit-card"></i>
                                    <p>Chưa có thông tin thanh toán</p>
                                    <small>Chưa có hóa đơn thanh toán nào được tạo</small>
                                </div>
                            </div>

                            <!-- Payment Content -->
                            <div id="payment-content" style="display: none;">
                                <!-- Revenue Information -->
                                <div class="revenue-info">
                                    <h5><i class="fas fa-receipt"></i> Hóa đơn thanh toán</h5>
                                    <div class="revenue-details">
                                        <div class="revenue-grid">
                                            <div class="revenue-item">
                                                <label><i class="fas fa-hashtag"></i> Mã hóa đơn:</label>
                                                <span id="revenue-id">-</span>
                                            </div>
                                            <div class="revenue-item">
                                                <label><i class="fas fa-calendar"></i> Ngày tạo:</label>
                                                <span id="revenue-created-date">-</span>
                                            </div>
                                            <div class="revenue-item">
                                                <label><i class="fas fa-money-bill-wave"></i> Tổng tiền:</label>
                                                <span id="revenue-total-amount" class="amount-highlight">0 VNĐ</span>
                                            </div>
                                            <div class="revenue-item">
                                                <label><i class="fas fa-check-circle"></i> Trạng thái:</label>
                                                <span id="revenue-status" class="status-badge">Chờ thanh toán</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- Revenue Details -->
                                <div class="revenue-details-section">
                                    <h5><i class="fas fa-list-ul"></i> Chi tiết dịch vụ</h5>
                                    <div class="revenue-details-table">
                                        <table>
                                            <thead>
                                                <tr>
                                                    <th>STT</th>
                                                    <th>Dịch vụ con</th>
                                                    <th>Mô tả</th>
                                                    <th>Đơn giá</th>
                                                    <th>Trạng thái</th>
                                                </tr>
                                            </thead>
                                            <tbody id="revenue-details-tbody">
                                                <!-- Dữ liệu sẽ được load động -->
                                            </tbody>
                                        </table>
                                    </div>
                                </div>

                                <!-- Bill Image Upload -->
                                <div class="bill-image-section">
                                    <h5><i class="fas fa-image"></i> Ảnh hóa đơn thanh toán</h5>
                                    <div class="image-upload-container">
                                        <div class="current-image" id="current-bill-image" style="display: none;">
                                            <img id="bill-image-preview" src="" alt="Bill Image" style="max-width: 300px; max-height: 200px; border-radius: 8px;">
                                            <button type="button" class="btn-secondary" onclick="window.removeBillImage()">
                                                <i class="fas fa-trash"></i> Xóa ảnh
                                            </button>
                                        </div>
                                        <div class="upload-area" id="upload-area">
                                            <div class="upload-content">
                                                <i class="fas fa-cloud-upload-alt"></i>
                                                <p>Kéo thả ảnh hóa đơn vào đây hoặc click để chọn file</p>
                                                <small>Hỗ trợ: JPG, PNG, PDF (tối đa 10MB)</small>
                                            </div>
                                            <input type="file" id="bill-image-input" accept="image/*,.pdf" style="display: none;">
                                        </div>
                                    </div>
                                </div>

                                <!-- Payment Actions -->
                                <div class="payment-actions">
                                    <div class="payment-summary">
                                        <div class="summary-row">
                                            <span class="summary-label">Tổng cộng:</span>
                                            <span class="summary-value" id="payment-total">0 VNĐ</span>
                                        </div>
                                        <div class="summary-row">
                                            <span class="summary-label">Đã thanh toán:</span>
                                            <span class="summary-value" id="payment-paid">0 VNĐ</span>
                                        </div>
                                        <div class="summary-row total-row">
                                            <span class="summary-label">Còn lại:</span>
                                            <span class="summary-value" id="payment-remaining">0 VNĐ</span>
                                        </div>
                                    </div>
                                    <div class="payment-buttons">
                                        <!-- <button type="button" class="btn-secondary" onclick="window.createSampleRevenue()">
                                            <i class="fas fa-plus"></i> Tạo dữ liệu mẫu
                                        </button> -->
                                        <button type="button" class="btn-secondary" onclick="window.viewPaymentHistory()">
                                            <i class="fas fa-history"></i> Lịch sử thanh toán
                                        </button>
                                        <button type="button" class="btn-primary" onclick="window.processPayment()">
                                            <i class="fas fa-credit-card"></i> Xử lý thanh toán
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Prescription Tab -->
                    <div id="prescriptionTab" class="tab-content">
                        <div class="prescription-management">
                            <h4><i class="fas fa-pills"></i> Kê đơn thuốc</h4>

                            <!-- Prescription Header -->
                            <div class="prescription-header">
                                <div class="prescription-info">
                                    <div class="record-grid">
                                        <div class="record-section">
                                            <label><i class="fas fa-calendar-alt"></i> Ngày kê đơn:</label>
                                            <input type="datetime-local" id="prescriptionDate" class="form-control">
                                            <!--chỗ của createdAt -->
                                        </div>
                                        <div class="record-section">
                                            <label><i class="fas fa-user-md"></i> Bác sĩ kê đơn:</label>
                                            <input type="text" readonly class="form-control" id="prescribingDoctorName">
                                        </div>
                                    </div>
                                    <div class="record-grid">
                                        <div class="record-section">
                                            <label><i class="fas fa-hashtag"></i> Số đơn thuốc:</label>
                                            <input type="text" readonly class="form-control" id="prescriptionNumber">
                                            <!--chỗ của drugId -->
                                        </div>
                                    </div>
                                    <div class="record-section">
                                        <label><i class="fas fa-stethoscope"></i> Chẩn đoán liên quan:</label>
                                        <textarea rows="2" id="prescriptionDiagnosis" class="form-control"
                                             placeholder="Chẩn đoán liên quan đến đơn thuốc..."></textarea>  
                                                <!--chỗ của drugNote  -->
                                    </div>
                                </div>
                            </div>
                            <!-- Drug Prescription List -->
                            <div class="drug-prescription">
                                <div class="prescription-section-header">
                                    <h5><i class="fas fa-list-ul"></i> Danh sách thuốc kê đơn</h5>
                                    <button type="button" class="btn-add-drug" onclick="window.addDrugPrescription()">
                                        <i class="fas fa-plus"></i> Thêm thuốc
                                    </button>
                                </div>

                                <div class="drugs-list" id="drugsList">
                                    <!-- Drug Item -->
                                </div>
                            </div>

                            <!-- Prescription Summary -->
                            <div class="prescription-summary">
                                <h5><i class="fas fa-clipboard-check"></i> Tóm tắt đơn thuốc</h5>
                                <div class="summary-content">
                                    <div class="summary-stats">
                                        <div class="stat-item">
                                            <span class="stat-number">2</span>
                                            <span class="stat-label">Loại thuốc</span>
                                        </div>
                                    </div>
                                    <div class="prescription-notes">
                                        <label><i class="fas fa-notes-medical"></i> Lời dặn chung của bác sĩ:</label>
                                        <textarea rows="3" id="generalNotes" class="form-control"
                                            placeholder="Lời dặn tổng quát cho bệnh nhân về việc sử dụng thuốc...">Tuân thủ đúng liều dùng và thời gian. Báo với bác sĩ nếu có tác dụng phụ bất thường. Không tự ý ngừng thuốc mà không tham khảo ý kiến bác sĩ.</textarea>
                                    </div>
                                </div>
                            </div>

                            <!-- Prescription Actions -->
                            <div class="prescription-actions">
                                <button type="button" class="btn-secondary" onclick="window.previewPrescription()">
                                    <i class="fas fa-eye"></i> Xem trước đơn thuốc
                                </button>
                                <!-- <button type="button" class="btn-print" onclick="window.printPrescription()">
                                <i class="fas fa-print"></i> In đơn thuốc
                            </button> -->
                                <button type="button" class="btn-primary" onclick="window.savePrescription()">
                                    <i class="fas fa-save"></i> Lưu đơn thuốc
                                </button>
                            </div>
                        </div>
                    </div>
                    <!-- Tests Tab -->
                    <div id="testsTab" class="tab-content">
                        <div class="test-results">
                            <h4><i class="fas fa-flask"></i> Kết quả xét nghiệm </h4>
                            <!-- Booking Steps Results -->
                            <div class="booking-steps-results">
                                <h5><i class="fas fa-vial"></i> Kết quả các bước đã thực hiện</h5>
                                <div class="step-result-item">
                                    <div class="step-result-header">
                                        <div class="step-info">
                                            <h6 contenteditable="true" class="editable-title"></h6>
                                            <input type="datetime-local" class="editable-date">
                                        </div>
                                        <select class="step-status-select">
                                            <option value="completed" selected>Hoàn thành</option>
                                            <option value="pending">Đang chờ</option>
                                            <option value="cancelled">Đã hủy</option>
                                        </select>
                                    </div>
                                    <div class="step-result-content">
                                        <div class="result-grid">
                                            <div class="result-item">
                                                <input type="text" class="editable-label" value="Nồng độ"
                                                    placeholder="Tên chỉ số">:
                                                <input type="text" class="editable-result" value="45"
                                                    placeholder="Giá trị">
                                                <select class="unit-select">
                                                    <option value="triệu/ml" selected>triệu/ml</option>
                                                    <option value="mIU/ml">mIU/ml</option>
                                                    <option value="ng/ml">ng/ml</option>
                                                    <option value="pg/ml">pg/ml</option>
                                                    <option value="%">%</option>
                                                </select>
                                                <select class="status-select">
                                                    <option value="Bình thường" selected>Bình thường</option>
                                                    <option value="Cao">Cao</option>
                                                    <option value="Thấp">Thấp</option>
                                                    <option value="Bất thường">Bất thường</option>
                                                </select>
                                            </div>
                                            <div class="result-item">
                                                <input type="text" class="editable-label" value="Khả năng vận động"
                                                    placeholder="Tên chỉ số">:
                                                <input type="text" class="editable-result" value="65"
                                                    placeholder="Giá trị">
                                                <select class="unit-select">
                                                    <option value="%" selected>%</option>
                                                    <option value="mIU/ml">mIU/ml</option>
                                                    <option value="ng/ml">ng/ml</option>
                                                    <option value="pg/ml">pg/ml</option>
                                                    <option value="triệu/ml">triệu/ml</option>
                                                </select>
                                                <select class="status-select">
                                                    <option value="Bình thường" selected>Bình thường</option>
                                                    <option value="Cao">Cao</option>
                                                    <option value="Thấp">Thấp</option>
                                                    <option value="Bất thường">Bất thường</option>
                                                </select>
                                            </div>
                                            <div class="result-item">
                                                <input type="text" class="editable-label" value="Hình thái"
                                                    placeholder="Tên chỉ số">:
                                                <input type="text" class="editable-result" value="8"
                                                    placeholder="Giá trị">
                                                <select class="unit-select">
                                                    <option value="%" selected>%</option>
                                                    <option value="mIU/ml">mIU/ml</option>
                                                    <option value="ng/ml">ng/ml</option>
                                                    <option value="pg/ml">pg/ml</option>
                                                    <option value="triệu/ml">triệu/ml</option>
                                                </select>
                                                <select class="status-select">
                                                    <option value="Bình thường" selected>Bình thường</option>
                                                    <option value="Cao">Cao</option>
                                                    <option value="Thấp">Thấp</option>
                                                    <option value="Bất thường">Bất thường</option>
                                                </select>
                                            </div>
                                        </div>
                                        <div class="result-note">
                                            <strong>Ghi chú:</strong>
                                            <textarea class="editable-note"
                                                placeholder="Nhập ghi chú...">Chất lượng tinh trùng tốt, phù hợp cho IVF</textarea>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="save-results-section">
                                <button type="button" class="btn-primary" onclick="window.saveAllTestResults()">
                                    <i class="fas fa-save"></i> Lưu kết quả xét nghiệm
                                </button>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button class="btn-secondary" onclick="window.closeModal()">
                        <i class="fas fa-times"></i> Đóng
                    </button>
                    <button class="btn-print" onclick="window.printRecord()">
                        <i class="fas fa-print"></i> In hồ sơ
                    </button>
                    <button class="btn-primary" onclick="window.checkout()">
                        <i class="fas fa-save"></i> Checkout
                    </button>
                </div>
            </div>
        </div>

        <!-- Patient List Modal -->
        <div id="patientListModal" class="modal">
            <div class="modal-content large">
                <div class="modal-header">
                    <h3>Danh sách bệnh nhân</h3>
                    <span class="close" onclick="window.closePatientListModal()">&times;</span>
                </div>
                <div class="modal-body">
                    <div class="search-box">
                        <input type="text" id="searchInput" placeholder="Tìm kiếm bệnh nhân..."
                            onkeyup="window.searchPatients()">
                        <i class="fas fa-search"></i>
                    </div>
                    <div class="patient-table">
                        <table>
                            <thead>
                                <tr>
                                    <th>Tên bệnh nhân</th>
                                    <th>Tuổi</th>
                                    <th>Số điện thoại</th>
                                    <th>Lần khám gần nhất</th>
                                    <th>Thao tác</th>
                                </tr>
                            </thead>
                            <tbody id="patientTableBody">
                                <tr>
                                    <td>Phạm Thị Hoa</td>
                                    <td>30</td>
                                    <td>0456789123</td>
                                    <td>24/06/2024</td>
                                    <td>
                                        <button class="btn-small" onclick="window.editPatientFromList('hoa')">Sửa
                                            bệnh
                                            án</button>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <script src="js/doctor-common.js"></script>
    <script src="js/script.js"></script>
    <script src="js/next-appointment.js"></script>
    <script src="js/doctor-dashboard.js"></script>

</body>

</html>